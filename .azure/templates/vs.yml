parameters:
  toolchain: ''

steps:
  - powershell: |
      if ("$(STATIC_LINK)" -eq "ON") {
        echo "##vso[task.setvariable variable=PLATFORM]x64-windows-static"
      } else {
        echo "##vso[task.setvariable variable=PLATFORM]x64-windows"
      }
      if ("${{ parameters.toolchain }}" -eq "vs2017") {
        echo "##vso[task.setvariable variable=GENERATOR]Visual Studio 15 2017 Win64"
      } else {
        echo "##vso[task.setvariable variable=GENERATOR]Visual Studio 16 2019"
      }
      echo "##vso[task.setvariable variable=TOOLCHAIN_FILE]$(VCPKG_INSTALLATION_ROOT)/scripts/buildsystems/vcpkg.cmake"
    displayName: "Setup variables"
  - template: ./vcpkg.yml
  - template: ./build.yml
    parameters:
      buildTarget: ALL_BUILD
      testTarget: RUN_TESTS
      extraArgs: -DCMAKE_TOOLCHAIN_FILE="$(TOOLCHAIN_FILE)" -DVCPKG_TARGET_TRIPLET="$(PLATFORM)"
