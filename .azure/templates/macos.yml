parameters:
  config: ''
  static: ''

steps:
  - bash: >
      echo "##vso[task.setvariable variable=HOMEBREW_PREFIX]$(brew --prefix)"
    displayName: "Get HOMEBREW_PREFIX"
  - bash: brew install boost mbedtls libsodium libmaxminddb libressl rapidjson
    displayName: "Prepare homebrew packages"
  - template: ./build.yml
    parameters:
      config: ${{ parameters.config }}
      static: ${{ parameters.static }}
      extraArgs: "-D OPENSSL_ROOT_DIR=$(HOMEBREW_PREFIX)/opt/libressl"
